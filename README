flatdeb - Steam
===============

flatdeb is a proof of concept for building Flatpak runtimes and apps
from Debian packages. This repository sets it up for Steam.

Walkthrough
-----------

On a Debian 9 VM:

    sensible-editor /etc/apt/sources.list    # and enable backports
    apt install debootstrap systemd-container time
    apt install python3 python3-debian python3-gi python3-yaml
    apt install -t stretch-backports flatpak flatpak-builder ostree

(Or install on Debian testing/unstable.)

Also install the latest versions of
[fakemachine](https://github.com/go-debos/fakemachine)
and [debos](https://github.com/go-debos/debos).

You will probably want to use a caching proxy such as apt-cacher-ng to
download `.deb` packages, which you can do by prefixing all the commands
below with `env http_proxy=http://192.168.122.1:3142` or similar.

Finally, put exported Ubuntu, Steam Runtime and SteamOS keys in
suites/valve-archive-keyring.gpg (0x9E46D8DCD0BBF5AE and
0x7DEEB7438ABDDD96), suites/valve-steam-keyring.gpg (0xF24AEA9FB05498B7)
and suites/ubuntu-archive-keyring.gpg (ubuntu-archive-keyring).

Then you can run:

    flatdeb/run.py --suite=scout_beta --arch=amd64,i386 base
    flatdeb/run.py --suite=scout_beta --arch=i386 base
    flatdeb/run.py --suite=scout_beta --arch=amd64,i386 runtimes \
        runtimes/com.valvesoftware.SteamRuntime.yaml
    flatdeb/run.py --suite=scout_beta --arch=i386 runtimes \
        runtimes/com.valvesoftware.SteamRuntime.yaml
    flatdeb/run.py --arch=amd64,i386 app \
        apps/org.debian.packages.mesa_utils.yaml
    flatdeb/run.py --arch=i386 app \
        apps/org.debian.packages.mesa_utils.yaml
    flatdeb/run.py --arch=amd64,i386 app \
        apps/com.valvesoftware.Steam.yaml
    flatdeb/run.py --arch=i386 app \
        apps/com.valvesoftware.Steam.yaml

On the host, or a test machine onto which you have copied
`$HOME/.cache/flatdeb/repo` with `rsync` or similar:

    flatpak --user remote-add --no-gpg-verify flatdeb $HOME/.cache/flatdeb/repo
    flatpak --user install flatdeb org.debian.packages.mesa_utils
    flatpak run org.debian.packages.mesa_utils
    flatpak --user install flatdeb com.valvesoftware.Steam
    flatpak run com.valvesoftware.Steam
