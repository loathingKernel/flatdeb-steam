flatdeb
=======

flatdeb is a proof of concept for building Flatpak runtimes and apps
from Debian packages.

Walkthrough
-----------

On a Debian 9 VM (assuming username "user"):

    adduser user sudo
    visudo          # and set %sudo ALL=(ALL:ALL) NOPASSWD: ALL
    apt install debootstrap flatpak flatpak-builder openssh-server \
        sudo systemd-container time
    passwd user     # and have a password

Make sure the VM's /tmp is on the same filesystem as the user's $HOME,
otherwise ostree will try (and fail) to hard-link files across the
filesystem boundary.

On the host system (or the VM if you're running everything there):

    apt install python3 python3-debian python3-gi python3-yaml sshfs

You need an apt-cacher-ng on http://192.168.122.1:3142 (currently
hard-coded), visible to both the host system and the VM. If you don't
have that, edit run.py accordingly.

Also edit org.debian.packages.openarena.yaml to specify where you have
put your clones of ioquake3 and openarena (the way flatdeb currently
handles http_proxy means cloning over https is probably not going to
work so well).

Finally, put a copy of debian-archive-keyring.gpg in this directory.

On the host (assuming VM is "ikea.virt"):

    ssh-copy-id ikea.virt
    ./run.py --remote=ikea.virt --suite=stretch --arch=amd64 base
    ./run.py --remote=ikea.virt --suite=stretch --arch=amd64 runtimes \
        runtimes/net.debian.flatpak.Base.yaml
    ./run.py --remote=ikea.virt --suite=stretch --arch=amd64 runtimes \
        runtimes/net.debian.flatpak.Games.yaml
    ./run.py --remote=ikea.virt --suite=stretch --arch=amd64 app \
        apps/org.debian.packages.hello.yaml
    ./run.py --remote=ikea.virt --suite=stretch --arch=amd64 app \
        apps/org.debian.packages.openarena.yaml
    ./run.py --remote=ikea.virt --suite=stretch --arch=amd64 app \
        apps/org.debian.packages.mesa_utils.yaml

On the host, or a test machine onto which you have copied
`$HOME/.cache/flatdeb/repo` with `rsync` or similar:

    flatpak --user remote-add --no-gpg-verify flatdeb $HOME/.cache/flatdeb/repo
    flatpak --user install flatdeb org.debian.packages.hello
    flatpak run org.debian.packages.hello
    flatpak --user install flatdeb org.debian.packages.openarena
    flatpak run org.debian.packages.openarena

(Or run it all on the VM, without `--remote` - less well-tested.)

Bonus content: Steam as a Flatpak, with multiarch
-------------------------------------------------

https://github.com/smcv/flatdeb-steam
